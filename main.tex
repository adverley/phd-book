% !TeX spellcheck = en_GB
% !BIB program = biber
% !TEX TS-program = xelatex
% !TEX encoding = UTF-8 Unicode

\documentclass[fontsize=11pt,open=right,numbers=noenddot,]{scrbook} % appendixprefix

% configure directory structure
% MUST be loaded as FIRST package!
\usepackage{subfiles}
\providecommand{\home}{.}
% \usepackage{\home/mypreamble}

\usepackage[dutch,english]{babel}

% -- python code snippets formatting
% The package scrhack redefines macros of other packages. It should be loaded at the very end or very start according to some...
% \usepackage{scrhack}
% source code
\usepackage{listings}
\lstset{
	breaklines=true,
	postbreak=\raisebox{0ex}[0ex][0ex]{\ensuremath{\color{red}\hookrightarrow\space}},
	numbers=left,
	numbersep=5pt,
	numberstyle=\tiny\color{gray},
	basicstyle=\footnotesize\ttfamily
}

%  ------

% configure fonts
\usepackage{fontspec}
\setmainfont{SourceSerifPro}[%
Extension=.otf,
Ligatures=TeX,
UprightFont=SourceSerifPro-Regular,
BoldFont=SourceSerifPro-Bold,
ItalicFont=SourceSerifPro-It,
BoldItalicFont=SourceSerifPro-BoldIt,
Path=\home/fonts/]

\newfontfamily{\phdsansfont}{SourceSansPro}[%
Extension=.otf,
Ligatures=TeX,
UprightFont = SourceSansPro-Regular,
BoldFont=SourceSansPro-Semibold,
ItalicFont=SourceSansPro-It,
BoldItalicFont=SourceSansPro-BoldIt,
Path=\home/fonts/]

\addtokomafont{disposition}{\phdsansfont}

\newfontfamily{\phdquotefont}{GloriaHallelujah}[%
Extension=.ttf,
UprightFont = GloriaHallelujah-Regular,
Path=\home/fonts/]

% configure geometry
\usepackage[%
	paperwidth=16cm,
	paperheight=24cm,
	margin=2.5cm,
	inner=2.5cm,
	outer=2.5cm,
	%textwidth=0.5\paperwidth,
	%marginparsep=0.05\paperwidth,
]{geometry}

% change counters for figures, chapters etc
\usepackage{chngcntr}

% dummy text
\usepackage{lipsum}
\usepackage[]{blindtext}

% text in the margin
\usepackage{marginnote}

% load external figures
\usepackage{graphicx}

% improved caption options
\usepackage{caption}

% header/footer styles
%\usepackage{fancyhdr}
\pagenumbering{arabic}

% better float placement
\usepackage{placeins}

% defines \theauthor, \thetitle etc. 
\usepackage{titling}

% bibilography
\usepackage{csquotes}
% \usepackage[backend=biber,style=numeric,citestyle=authoryear,sorting=none]{biblatex}
\usepackage[authordate,backend=biber]{biblatex-chicago}

\addbibresource{\home/references.bib}

% important boxes :D
\usepackage[most,skins]{tcolorbox}
\tcbset{textmarker/.style={%
        enhanced,
        parbox=false,boxrule=0mm,boxsep=0mm,arc=0mm,
        outer arc=0mm,left=6mm,right=3mm,top=7pt,bottom=7pt,
        toptitle=1mm,bottomtitle=1mm,oversize}}

% define new colorboxes
\newtcolorbox{keyMessageBox}{textmarker,
    borderline west={6pt}{0pt}{green!45!blue!75!white},
    colback=green!50!blue!25!white,
    colbacktitle=green!50!blue!25!white
}
\newtcolorbox{keyMessageBoxWithTitle}[1]{textmarker,
    borderline west={6pt}{0pt}{green!45!blue!75!white},
    colback=green!50!blue!25!white,
    title=#1,
    colbacktitle=green!45!blue!75!white,
    % fonttitle=\bfseries,
}

% define commands for easy access
\newcommand{\key}[1]{\begin{keyMessageBox} #1 \end{keyMessageBox}}
\newcommand{\keyWithTitle}[2]{\begin{keyMessageBoxWithTitle}{#1}{#2}\end{keyMessageBoxWithTitle}}


% define header styles

\renewcommand{\chaptermark}[1]{\markboth{\chaptername\ \thechapter}{}}%
\renewcommand{\sectionmark}[1]{\markright{\thesection\ #1}}%

% main header and footer
%\fancypagestyle{mainstyle}{%
%    \fancyhf{}                           % clear all header and footer fields
%    \fancyhead[LO,RE]{\textbf{\nouppercase{\thepage}}}%
%    \fancyhead[RO]{\textbf{\nouppercase{\rightmark}}}%
%    \fancyhead[LE]{\textbf{\nouppercase{\leftmark}}}%
%    \fancyfoot{}
%    \renewcommand{\headrulewidth}{0.4pt} % add horizontal line of 0.4pt thick
%}
 % needed to get correct page style during subfile document compilation
%\pagestyle{mainstyle}

% redefine plain/empty style
%\fancypagestyle{plain}{%
%    \fancyhf{} % get rid of headers
%    \fancyhead[LO,RE]{\textbf{\nouppercase{\thepage}}}%
%    \renewcommand{\headrulewidth}{0pt} % and the line
%}
%\fancypagestyle{empty}{%
%    \fancyhf{} % get rid of headers
%    %\fancyhead[LO,RE]{\textbf{\nouppercase{\thepage}}}%
%    \renewcommand{\headrulewidth}{0pt} % and the line
%}

% define tables with fixed column width
\usepackage{tabularx}              % more table options
\newcolumntype{L}[1]{>{\raggedright\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}
\newcolumntype{C}[1]{>{\centering\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}
\newcolumntype{R}[1]{>{\raggedleft\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}                                          

% abbreviation list
\usepackage[acronyms,nomain,nonumberlist]{glossaries} 

% load abbreviations
\input{\home/acronyms}
\makeglossaries

% elegant units
\usepackage{siunitx} 

\sisetup{
    detect-all,
    %group-digits            = false,
    %input-symbols           = ( ) [ ] - + \pm,
    %table-align-text-post   = false,
    %input-signs             = ,
    %input-comparators = ,
    separate-uncertainty = true,
    per-mode=fraction,
    %input-uncertainty-signs = true,
    %decimalsymbol=comma, % not needed, as implied by `locale=DE` option
    locale = UK,
    math-ohm=\Omega,
    text-ohm=\ensuremath{\Omega},
    math-rm = \text,
    range-phrase=\,--\,,
    range-units=single,
}  

% defines \theauthor, \thetitle etc. 


% draw diagrams and electrical circuits 
\usepackage{tikz}   
\usepackage{circuitikz}    
\usetikzlibrary{calc,positioning,fit,arrows.meta,backgrounds,fit, patterns}   

% block diagrams in TikZ
\tikzstyle{line} = [line width=0.4mm]
\tikzstyle{<line>} = [{Latex[length=3mm, width=3mm]}-{Latex[length=3mm, width=3mm]},line width=0.4mm]
\tikzstyle{line>} = [-{Latex[length=3mm, width=3mm]},line width=0.4mm]
\tikzstyle{<line} = [{Latex[length=3mm, width=3mm]}-,line width=0.4mm]
\tikzset{
    block/.style = {draw,
        rectangle,
        minimum height=3em,
        minimum width=3em},
    tmp/.style = {coordinate},
    sum/.style = {draw, circle, node distance=1cm},
    input/.style = {coordinate},
    design/.style = {fill=green,fill opacity=0.1,text opacity=1},
    output/.style = {coordinate},
    lowpass/.pic={%
        \draw (-0.4cm,0.25cm) 
        -- ++(0.5cm,0) 
        -- ++(0.3cm,-0.5cm);
        \draw (-0.4cm-0.1cm,0.1cm+0.4cm) 
        -- (0.4cm+0.1cm,0.1cm+0.4cm) 
        -- (0.4cm+0.1cm,-0.1cm-0.4cm) 
        -- (-0.4cm-0.1cm,-0.1cm-0.4cm) 
        -- cycle;},
    highpass/.pic={%
        \draw (0.4cm,0.25cm) 
        -- ++(-0.5cm,0) 
        -- ++(-0.3cm,-0.5cm);
        \draw (-0.4cm-0.1cm,0.1cm+0.4cm) 
        -- (0.4cm+0.1cm,0.1cm+0.4cm) 
        -- (0.4cm+0.1cm,-0.1cm-0.4cm) 
        -- (-0.4cm-0.1cm,-0.1cm-0.4cm) 
        -- cycle;},
    bandpass/.pic={%
        \draw (-0.4cm,-0.25cm) 
        -- ++(0.2cm,+0.5cm)
        -- ++(0.4cm,0) 
        -- ++(0.2cm,-0.5cm);
        \draw (-0.4cm-0.1cm,0.1cm+0.4cm) 
        -- (0.4cm+0.1cm,0.1cm+0.4cm) 
        -- (0.4cm+0.1cm,-0.1cm-0.4cm) 
        -- (-0.4cm-0.1cm,-0.1cm-0.4cm) 
        -- cycle;},
}

% add hyperlinks to references
\usepackage{hyperref} 

% better references than default \ref
\usepackage[noabbrev, nameinlink, capitalise]{cleveref} 

% appendices
\crefname{appendixchap}{appendix}{appendices} % for \cref
\Crefname{appendixchap}{Appendix}{Appendices} % for \Cref

% for convenience
\def\thepromotors{}
\def\thementors{}
\newcommand{\promotors}[1]{\def\thepromotors{#1}}
\newcommand{\supervisors}[1]{\def\thementors{#1}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% DO NOT EDIT ABOVE THIS LINE. EDIT AT OWN RISK!                             %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%   CUSTOM IMPORTS
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% \usepackage{standalone} Gebruikt voor subfiles tex dat tikz figuren bevatten

\usepackage{amsfonts}       % blackboard math symbols dont use in conjunction with mathdesign
\usepackage{amssymb}
\usepackage{amsmath} % equation* env
\usepackage{bm} % for bold in math


% Choose a math font
%  math design ruins parts of the layout leaders commands 
% \usepackage[charter]{mathdesign} 
% \usepackage{stickstootext} \usepackage[stix2, upint, varbb]{newtxmath} 
% \usepackage{eulerpx} \usepackage{newpxtext}
% \usepackage{cochineal} \usepackage[cochineal]{newtxmath}
\usepackage[OMLmathrm,OMLmathbf,sfdefault=fav,scaled=0.875]{isomath} % typesetting vectors etc 
% \usepackage{isomath} % typesetting vectors etc 
\input{\home/mathcmds.tex}

\usepackage{subcaption} % for subfigures
\usepackage{todonotes} % to very clearly add todoes
\usepackage{xcolor} % more colors
\usepackage{rotating} % to rotate tables and figures
\usepackage{threeparttable} % for tables with footnotes in

\input{color-definitions.tex}

% [end]

\usetikzlibrary{calc}
\usetikzlibrary{shapes,arrows} % For flowchart and Diagram
\usetikzlibrary{shapes.geometric}

% --- SETUP TIKZ DEFAULT STYLES ---- %
\input{tikzDefaultStyle.tex}

\usepackage{array}
\usepackage{booktabs} % for fancier rules for tables
\usepackage{tabularx} % tables that fill up to how large you want them to be 
\usepackage{tabulary} % tables that fill up to how large you want them to be 
\usepackage{array, makecell}
\usepackage{adjustbox}
\usepackage[english]{babel}

\usepackage{siunitx}
\sisetup{load-configurations = abbreviations}

% MATH STUFF
\DeclareMathOperator*{\argmax}{\arg\!\max}
\DeclareMathOperator*{\argmin}{\arg\!\min}

% Easier lists
\usepackage[ampersand]{easylist}

% Nicier math breaklines
\usepackage{flexisym}
\usepackage{breqn}

\title{Dit wordt een zeer goede titel: %
  zeer goede titel} 
\def\thetitleNL{De nederlandstalige titel}

\newcommand{\examreviewer}[3]{\begin{flushleft}\large#1 (#2)\\\normalsize #3 \end{flushleft}}

% Author
\author{Andreas Verleysen}

\promotors{prof.\ dr.\ ir.\ Francis wyffels, prof.\ dr.\ ir. Joni Dambre}
\supervisors{Who let the dogs out}

% define figure paths thoughout the entire document to make loading figures faster and easier
\graphicspath{{\home/figures/}{\home/chapters/background/figures/}{figures/}}

% You can find additional settings for chapter headings in the explanation for
% \RedeclareSectionCommand and the commands \chapterlineswithprefixformat and
% \chapterlinesformat in section 21.3, part II.

%\makeatletter
%\renewcommand{\chapterlinesformat}[3]{%
%	\colorbox{yellow}{%
%		\parbox{\dimexpr\linewidth-2\fboxrule-2\fboxsep}{%
%			#2#3%
%		}%
%	}%
%\makeatother

\renewcommand*{\chapterformat}{%
	\enskip\mbox{\scalebox{3}{\thechapter\autodot}}}
\renewcommand\chapterlinesformat[3]{%
	\parbox[b]{\textwidth}{\hrulefill#2}\begin{flushleft}\par%
	#3\par
	\end{flushleft}%
	\parbox[b]{\textwidth}{\hrulefill}}
	%\hrule}
\RedeclareSectionCommand[afterskip=1.5\baselineskip]{chapter}

\usepackage{scrlayer-scrpage}
\KOMAoptions{headsepline=true}
%\ohead{\thechapter}
\setkomafont{pagehead}{\normalfont\phdsansfont}
\setkomafont{pagenumber}{\normalfont\phdsansfont}

\KOMAoptions{parskip=half}


\def\vhrulefill{\leavevmode\leaders\hrule height 0.7ex depth \dimexpr0.8pt-0.7ex\hfill\kern0pt}
\setkomafont{chapterentry}{\normalfont\bfseries}
%\TOCLineLeaderFill[cdot]
%\RedeclareSectionCommands[toclinefill=$\cdot$]{section, subsection}
%\RedeclareSectionCommands[toclinefill={\TOCLineLeaderFill[$\cdot$]}]{section, subsection}
%\RedeclareSectionCommands[toclinefill=\color{lightgray}\vhrulefill]{section, subsection}


%\newtcbox{\customcaptionformat}{
%  enhanced,
%  nobeforeafter,
%  tcbox raise base,
%  boxrule=0.4pt,
%  top=0mm,
%  bottom=0mm,
%  right=0mm,
%  left=0mm,
%  arc=0pt,
%  boxsep=1pt,
%  %before upper={\vphantom{dlg}},
%  colframe=white!50!black,
%  coltext=black,
%  colback=white!90!black,
%  %overlay={\begin{tcbclipinterior}\fill[green!75!blue!50!white] (frame.south west)
%  %  rectangle node[text=white,font=\sffamily\bfseries\tiny,rotate=90] {LIB} ([xshift=4mm]frame.north west);\end{tcbclipinterior}}
%}
%
%
%\pdfstringdefDisableCommands{%
%  \def\customcaptionformat#1{'#1'}%
%}
%
%\robustify{\customcaptionformat}
%
%\renewcommand*{\captionformat}{\quad}
%\setcapindent{0em}
%\renewcommand*{\figureformat}{\customcaptionformat{\figurename~\thefigure\autodot}}
%\renewcommand*{\tableformat}{\customcaptionformat{\tablename~\thetable\autodot}}

\setcapindent{0em}


%\renewcommand*{\listingsformat}{\customcaptionformat{\tablename~\thetable\autodot}}

\setkomafont{captionlabel}{\normalfont\phdsansfont\bfseries}
%\setkomafont{captionlabel}{\normalfont}

\usepackage[]{caption}


%\makeatletter
%\renewcommand{\sectionlinesformat}[4]{%
%	\@tempswafalse
%	\ifstr{#1}{section}{%
%		\hspace*{#2}%
%		\begin{tcolorbox}[%
%			enhanced,
%			grow to left by=1cm,
%			before skip=6pt,after skip=6pt,
%			borderline west={3mm}{0pt}{red}]
%			\@hangfrom{\hskip #2#3}{#4}%
%		\end{tcolorbox}%
%	}{%
%		\@hangfrom{\hskip #2#3}{#4}%
%	}%
%}
%\makeatother

% ================== Preamble of dataset paper =============================
\usepackage[cache=true]{minted}             % lets typeset python code with this
% -- no red boxes on parser error:
\AtBeginEnvironment{minted}{%
  \renewcommand{\fcolorbox}[4][]{#4}}
% --
\usepackage{listings}    % for json file
\usepackage{balance}
\usepackage{subcaption}

% -------------------- CUSTOM ENVIRONMENTS -------------------- 
\newenvironment{code}{\captionsetup{type=listing}}{}


% ----------------------------------
%   json file description code
% ----------------------------------

\colorlet{punct}{red!60!black}
\definecolor{background}{HTML}{EEEEEE}
\definecolor{delim}{RGB}{20,105,176}
\colorlet{numb}{magenta!60!black}

\lstdefinelanguage{json}{
    basicstyle=\normalfont\ttfamily,
    numbers=left,
    numberstyle=\scriptsize,
    stepnumber=0,
    numbersep=8pt,
    showstringspaces=false,
    breaklines=true,
    frame=lines,
    backgroundcolor=\color{background},
    literate=
     *{0}{{{\color{numb}0}}}{1}
      {1}{{{\color{numb}1}}}{1}
      {2}{{{\color{numb}2}}}{1}
      {3}{{{\color{numb}3}}}{1}
      {4}{{{\color{numb}4}}}{1}
      {5}{{{\color{numb}5}}}{1}
      {6}{{{\color{numb}6}}}{1}
      {7}{{{\color{numb}7}}}{1}
      {8}{{{\color{numb}8}}}{1}
      {9}{{{\color{numb}9}}}{1}
      {:}{{{\color{punct}{:}}}}{1}
      {,}{{{\color{punct}{,}}}}{1}
      {\{}{{{\color{delim}{\{}}}}{1}
      {\}}{{{\color{delim}{\}}}}}{1}
      {[}{{{\color{delim}{[}}}}{1}
      {]}{{{\color{delim}{]}}}}{1},
}

\makeatletter
% Solution to make lstlisting and listing number in one context
\AtBeginDocument{\let\c@listing\c@lstlisting}

% Balancing bibliography cols at end of paper
%    \def\balanceissued{unbalanced}%flag to indicate if \balance has been used
%    \let\oldbibitem\bibitem
%    \def\bibitem{%
%        \ifnum\thepage=\lastpage@lastpage%
%            \expandafter\ifx\expandafter\relax\balanceissued\relax\else%
%                \balance%
%                \gdef\balanceissued{\relax}\fi%
%            \else\fi%
%        \oldbibitem}

\makeatother


% ----- custom TOC --
% Let paragraph behave as a subsection qua layout
\makeatletter
\renewcommand\paragraph{\@startsection{paragraph}{4}{\z@}%
            {-2.5ex\@plus -1ex \@minus -.25ex}%
            {1.25ex \@plus .25ex}%
            {\normalfont\normalsize\bfseries}}
\makeatother
\setcounter{secnumdepth}{3} % how many sectioning levels to assign numbers to
\setcounter{tocdepth}{3}    % how many sectioning levels to show in ToC

% \usepackage{scrhack}
% \usepackage{titlesec}
% \setcounter{tocdepth}{4}
% \setcounter{secnumdepth}{4}


% Allow some overfull to come!
\hfuzz=20.004pt 


% start the actual document
\begin{document}
% these parameters control the breaking of words and line overflow
\tolerance=500
\emergencystretch=3em
\hyphenpenalty=500
\hbadness=10000

\pagenumbering{gobble}

%\pagestyle{empty}
%\subfile{chapters/coverpage/coverpage}

\pagestyle{empty}
\subfile{chapters/titlepage/titlepage}

\cleardoublepage
\subfile{chapters/quote}
\subfile{chapters/examination_board}

\frontmatter
\pagestyle{plain.scrheadings}

\subfile{chapters/acknowledgements}
\subfile{chapters/summary_english}
\subfile{chapters/summary_dutch}

\cleardoublepage
\tableofcontents
\cleardoublepage
\listoffigures
\cleardoublepage
\listoftables
\cleardoublepage

% do NOT forget to run `makeglossaries main` on the command line in the main folder of this document
%\renewcommand*{\glsmcols}{1}
%\setglossarystyle{mcolindex}
\printglossary[type=\acronymtype,nopostdot]

\mainmatter
\pagestyle{scrheadings}
\renewcommand*{\chapterpagestyle}{empty}
%\pagestyle{mainstyle}

\include{chapters/all_chapters}

\cleardoublepage

\appendix

% TODO: appendices
%    \crefalias{chapter}{appendixchap} 
\subfile{appendices/PCB/PCB}

\backmatter

\printbibliography


\end{document}
